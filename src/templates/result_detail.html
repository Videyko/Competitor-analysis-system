{% extends "base.html" %}

{% block title %}–†–µ–∑—É–ª—å—Ç–∞—Ç –∞–Ω–∞–ª—ñ–∑—É - {{ result.site_url }}{% endblock %}
{% block page_type %}result{% endblock %}

{% block content %}
<div class="container-fluid">
    <div class="row">
        <div class="col-md-12">
            <div class="d-flex justify-content-between align-items-center mb-4">
                <h1><i class="fas fa-chart-line"></i> –†–µ–∑—É–ª—å—Ç–∞—Ç –∞–Ω–∞–ª—ñ–∑—É</h1>
                <div>
                    <button class="btn btn-outline-secondary me-2" onclick="history.back()">
                        <i class="fas fa-arrow-left"></i> –ù–∞–∑–∞–¥
                    </button>
                    <a href="/result/{{ result.task_id }}/download" class="btn btn-primary">
                        <i class="fas fa-download"></i> –ó–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ Excel
                    </a>
                </div>
            </div>

            <!-- –Ü–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è –ø—Ä–æ —Å–∞–π—Ç -->
            <div class="card mb-4">
                <div class="card-header bg-primary text-white">
                    <h5 class="mb-0">
                        <i class="fas fa-globe"></i>
                        <a href="{{ result.site_url }}" target="_blank" class="text-white text-decoration-none">
                            {{ result.site_url }}
                        </a>
                    </h5>
                </div>
                <div class="card-body">
                    <div class="row text-center">
                        <div class="col-md-3">
                            <div class="stat-card neutral">
                                <div class="stat-number">{{ result.pages_analyzed }}</div>
                                <div class="stat-label">–°—Ç–æ—Ä—ñ–Ω–æ–∫ –ø—Ä–æ–∞–Ω–∞–ª—ñ–∑–æ–≤–∞–Ω–æ</div>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="stat-card positive">
                                <div class="stat-number">{{ result.positive_matches|length }}</div>
                                <div class="stat-label">–ü–æ–∑–∏—Ç–∏–≤–Ω–∏—Ö –∑–±—ñ–≥—ñ–≤</div>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="stat-card negative">
                                <div class="stat-number">{{ result.negative_matches|length }}</div>
                                <div class="stat-label">–ù–µ–≥–∞—Ç–∏–≤–Ω–∏—Ö –∑–±—ñ–≥—ñ–≤</div>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="stat-card neutral">
                                <div class="stat-number">{{ result.analysis_time|round(1) }}—Å</div>
                                <div class="stat-label">–ß–∞—Å –∞–Ω–∞–ª—ñ–∑—É</div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="row mt-3">
                        <div class="col-md-6">
                            <p><strong>Task ID:</strong> <code>{{ result.task_id }}</code>
                                <button class="btn btn-sm btn-outline-secondary ms-2" onclick="copyToClipboard('{{ result.task_id }}')">
                                    <i class="fas fa-copy"></i>
                                </button>
                            </p>
                            <p><strong>–ó–∞–≤–µ—Ä—à–µ–Ω–æ:</strong> {{ result.completed_at }}</p>
                        </div>
                        <div class="col-md-6">
                            <p><strong>–°—Ç–æ—Ä—ñ–Ω–æ–∫ –∑ –ø–æ–∑–∏—Ç–∏–≤–Ω–∏–º–∏ —Å–ª–æ–≤–∞–º–∏:</strong> {{ result.pages_with_positive|length }}</p>
                            <p><strong>–°—Ç–æ—Ä—ñ–Ω–æ–∫ –∑ –Ω–µ–≥–∞—Ç–∏–≤–Ω–∏–º–∏ —Å–ª–æ–≤–∞–º–∏:</strong> {{ result.pages_with_negative|length }}</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- –î–µ—Ç–∞–ª—å–Ω–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
            {% if result.detailed_stats and result.detailed_stats.summary %}
            <div class="row mb-4">
                <div class="col-md-6">
                    <div class="card">
                        <div class="card-header bg-success text-white">
                            <h5><i class="fas fa-thumbs-up"></i> –ü–æ–∑–∏—Ç–∏–≤–Ω—ñ –∫–ª—é—á–æ–≤—ñ —Å–ª–æ–≤–∞</h5>
                        </div>
                        <div class="card-body">
                            <div class="row text-center">
                                <div class="col-6">
                                    <div class="h3 text-success">{{ result.detailed_stats.summary.found_keywords }}</div>
                                    <small class="text-muted">–ó–Ω–∞–π–¥–µ–Ω–æ</small>
                                </div>
                                <div class="col-6">
                                    <div class="h3 text-muted">{{ result.detailed_stats.summary.not_found_keywords }}</div>
                                    <small class="text-muted">–ù–µ –∑–Ω–∞–π–¥–µ–Ω–æ</small>
                                </div>
                            </div>
                            <div class="progress mt-2">
                                <div class="progress-bar bg-success" style="width: {{ (result.detailed_stats.summary.found_keywords / result.detailed_stats.summary.total_keywords * 100)|round }}%"></div>
                            </div>
                            <small class="text-muted">{{ (result.detailed_stats.summary.found_keywords / result.detailed_stats.summary.total_keywords * 100)|round }}% –ø–æ–∫—Ä–∏—Ç—Ç—è</small>
                        </div>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="card">
                        <div class="card-header bg-danger text-white">
                            <h5><i class="fas fa-thumbs-down"></i> –ù–µ–≥–∞—Ç–∏–≤–Ω—ñ –∫–ª—é—á–æ–≤—ñ —Å–ª–æ–≤–∞</h5>
                        </div>
                        <div class="card-body">
                            <div class="row text-center">
                                <div class="col-6">
                                    <div class="h3 text-danger">{{ result.detailed_stats.summary.found_forbidden }}</div>
                                    <small class="text-muted">–ó–Ω–∞–π–¥–µ–Ω–æ</small>
                                </div>
                                <div class="col-6">
                                    <div class="h3 text-success">{{ result.detailed_stats.summary.not_found_forbidden }}</div>
                                    <small class="text-muted">–ù–µ –∑–Ω–∞–π–¥–µ–Ω–æ</small>
                                </div>
                            </div>
                            {% if result.detailed_stats.summary.total_forbidden > 0 %}
                            <div class="progress mt-2">
                                <div class="progress-bar bg-danger" style="width: {{ (result.detailed_stats.summary.found_forbidden / result.detailed_stats.summary.total_forbidden * 100)|round }}%"></div>
                            </div>
                            <small class="text-muted">{{ (result.detailed_stats.summary.found_forbidden / result.detailed_stats.summary.total_forbidden * 100)|round }}% –Ω–µ–≥–∞—Ç–∏–≤–Ω–∏—Ö —Å–ª—ñ–≤ –∑–Ω–∞–π–¥–µ–Ω–æ</small>
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>
            {% endif %}

            <!-- –ü–æ–∑–∏—Ç–∏–≤–Ω—ñ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏ -->
            {% if result.positive_matches %}
            <div class="card mb-4">
                <div class="card-header bg-success text-white">
                    <h5><i class="fas fa-thumbs-up"></i> –ü–æ–∑–∏—Ç–∏–≤–Ω—ñ –∫–ª—é—á–æ–≤—ñ —Å–ª–æ–≤–∞ ({{ result.positive_matches|length }})</h5>
                </div>
                <div class="card-body">
                    <div class="table-responsive">
                        <table class="table table-striped" id="positiveTable">
                            <thead>
                                <tr>
                                    <th>–ö–ª—é—á–æ–≤–µ —Å–ª–æ–≤–æ</th>
                                    <th>URL</th>
                                    <th>–ö—ñ–ª—å–∫—ñ—Å—Ç—å</th>
                                    <th>–ö–æ–Ω—Ç–µ–∫—Å—Ç</th>
                                    <th>–î—ñ—ó</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for match in result.positive_matches %}
                                <tr>
                                    <td>
                                        <span class="badge bg-success">{{ match.keyword }}</span>
                                    </td>
                                    <td>
                                        <a href="{{ match.url }}" target="_blank" class="text-decoration-none">
                                            <i class="fas fa-external-link-alt"></i> {{ match.url|truncate(60) }}
                                        </a>
                                    </td>
                                    <td>
                                        <strong class="text-success">{{ match.count }}</strong>
                                    </td>
                                    <td>
                                        <small class="context text-muted">{{ match.context|truncate(150) }}</small>
                                    </td>
                                    <td>
                                        <button class="btn btn-sm btn-outline-secondary" onclick="copyToClipboard('{{ match.url }}')">
                                            <i class="fas fa-copy"></i>
                                        </button>
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
            {% else %}
            <div class="alert alert-warning">
                <i class="fas fa-search"></i>
                <strong>–ü–æ–∑–∏—Ç–∏–≤–Ω—ñ –∫–ª—é—á–æ–≤—ñ —Å–ª–æ–≤–∞ –Ω–µ –∑–Ω–∞–π–¥–µ–Ω—ñ.</strong>
                –†–µ–∫–æ–º–µ–Ω–¥—É—î—Ç—å—Å—è –ø–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ –ø—Ä–∞–≤–∏–ª—å–Ω—ñ—Å—Ç—å –Ω–∞–ø–∏—Å–∞–Ω–Ω—è –∞–±–æ —Ä–æ–∑–≥–ª—è–Ω—É—Ç–∏ –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ñ –≤–∞—Ä—ñ–∞–Ω—Ç–∏.
            </div>
            {% endif %}

            <!-- –ù–µ –∑–Ω–∞–π–¥–µ–Ω—ñ –ø–æ–∑–∏—Ç–∏–≤–Ω—ñ —Å–ª–æ–≤–∞ -->
            {% if result.detailed_stats and result.detailed_stats.not_found_keywords %}
            <div class="card mb-4">
                <div class="card-header bg-warning text-dark">
                    <h5><i class="fas fa-search-minus"></i> –ù–µ –∑–Ω–∞–π–¥–µ–Ω—ñ –ø–æ–∑–∏—Ç–∏–≤–Ω—ñ –∫–ª—é—á–æ–≤—ñ —Å–ª–æ–≤–∞</h5>
                </div>
                <div class="card-body">
                    <div class="alert alert-warning">
                        <h6>–¶—ñ –∫–ª—é—á–æ–≤—ñ —Å–ª–æ–≤–∞ –Ω–µ –±—É–ª–∏ –∑–Ω–∞–π–¥–µ–Ω—ñ –Ω–∞ —Å–∞–π—Ç—ñ:</h6>
                        <div class="d-flex flex-wrap gap-2">
                            {% for keyword in result.detailed_stats.not_found_keywords %}
                            <span class="badge bg-warning text-dark">{{ keyword }}</span>
                            {% endfor %}
                        </div>
                        <hr>
                        <h6>üí° –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü—ñ—ó:</h6>
                        <ul class="mb-0">
                            <li>–ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ –ø—Ä–∞–≤–∏–ª—å–Ω—ñ—Å—Ç—å –Ω–∞–ø–∏—Å–∞–Ω–Ω—è –∫–ª—é—á–æ–≤–∏—Ö —Å–ª—ñ–≤</li>
                            <li>–†–æ–∑–≥–ª—è–Ω—É—Ç–∏ —Å–∏–Ω–æ–Ω—ñ–º–∏ –∞–±–æ –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ñ –≤–∞—Ä—ñ–∞–Ω—Ç–∏</li>
                            <li>–ó–≤–µ—Ä–Ω—É—Ç–∏—Å—è –¥–æ –ø–∞—Ä—Ç–Ω–µ—Ä–∞ —â–æ–¥–æ –≤—ñ–¥—Å—É—Ç–Ω–æ—Å—Ç—ñ –∑–≥–∞–¥–æ–∫</li>
                            <li>–ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ —á–∏ —Å–ª–æ–≤–∞ –Ω–∞–ø–∏—Å–∞–Ω—ñ —Ç—ñ—î—é –∂ –º–æ–≤–æ—é —â–æ —ñ –∫–æ–Ω—Ç–µ–Ω—Ç —Å–∞–π—Ç—É</li>
                        </ul>
                    </div>
                </div>
            </div>
            {% endif %}

            <!-- –ù–µ–≥–∞—Ç–∏–≤–Ω—ñ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏ -->
            {% if result.negative_matches %}
            <div class="card mb-4">
                <div class="card-header bg-danger text-white">
                    <h5><i class="fas fa-thumbs-down"></i> –ù–µ–≥–∞—Ç–∏–≤–Ω—ñ –∫–ª—é—á–æ–≤—ñ —Å–ª–æ–≤–∞ ({{ result.negative_matches|length }})</h5>
                </div>
                <div class="card-body">
                    <div class="alert alert-danger">
                        <strong>‚ö†Ô∏è –£–≤–∞–≥–∞!</strong> –ó–Ω–∞–π–¥–µ–Ω—ñ –∑–≥–∞–¥–∫–∏ –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç—ñ–≤ –∞–±–æ –∑–∞–±–æ—Ä–æ–Ω–µ–Ω–∏—Ö —Å–ª—ñ–≤.
                    </div>
                    
                    <div class="table-responsive">
                        <table class="table table-striped" id="negativeTable">
                            <thead>
                                <tr>
                                    <th>–ö–ª—é—á–æ–≤–µ —Å–ª–æ–≤–æ</th>
                                    <th>URL</th>
                                    <th>–ö—ñ–ª—å–∫—ñ—Å—Ç—å</th>
                                    <th>–ö–æ–Ω—Ç–µ–∫—Å—Ç</th>
                                    <th>–î—ñ—ó</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for match in result.negative_matches %}
                                <tr>
                                    <td>
                                        <span class="badge bg-danger">{{ match.keyword }}</span>
                                    </td>
                                    <td>
                                        <a href="{{ match.url }}" target="_blank" class="text-decoration-none">
                                            <i class="fas fa-external-link-alt"></i> {{ match.url|truncate(60) }}
                                        </a>
                                    </td>
                                    <td>
                                        <strong class="text-danger">{{ match.count }}</strong>
                                    </td>
                                    <td>
                                        <small class="context text-muted">{{ match.context|truncate(150) }}</small>
                                    </td>
                                    <td>
                                        <button class="btn btn-sm btn-outline-secondary" onclick="copyToClipboard('{{ match.url }}')">
                                            <i class="fas fa-copy"></i>
                                        </button>
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
            {% endif %}

            <!-- –ù–µ –∑–Ω–∞–π–¥–µ–Ω—ñ –Ω–µ–≥–∞—Ç–∏–≤–Ω—ñ —Å–ª–æ–≤–∞ (–ø–æ–∑–∏—Ç–∏–≤–Ω–æ!) -->
            {% if result.detailed_stats and result.detailed_stats.not_found_forbidden %}
            <div class="card mb-4">
                <div class="card-header bg-success text-white">
                    <h5><i class="fas fa-shield-alt"></i> –•–æ—Ä–æ—à–∞ –Ω–æ–≤–∏–Ω–∞!</h5>
                </div>
                <div class="card-body">
                    <div class="alert alert-success">
                        <h6>‚úÖ –¶—ñ –Ω–µ–≥–∞—Ç–∏–≤–Ω—ñ –∫–ª—é—á–æ–≤—ñ —Å–ª–æ–≤–∞ –ù–ï –±—É–ª–∏ –∑–Ω–∞–π–¥–µ–Ω—ñ:</h6>
                        <div class="d-flex flex-wrap gap-2">
                            {% for keyword in result.detailed_stats.not_found_forbidden %}
                            <span class="badge bg-success">{{ keyword }}</span>
                            {% endfor %}
                        </div>
                        <hr>
                        <p class="mb-0"><em>–¶–µ –ø–æ–∑–∏—Ç–∏–≤–Ω–∏–π –ø–æ–∫–∞–∑–Ω–∏–∫ - –ø–∞—Ä—Ç–Ω–µ—Ä –Ω–µ –∑–≥–∞–¥—É—î –≤–∞—à–∏—Ö –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç—ñ–≤!</em></p>
                    </div>
                </div>
            </div>
            {% endif %}

            <!-- –®–Ü –∞–Ω–∞–ª—ñ–∑ -->
            {% if result.ai_analysis %}
            <div class="card mb-4">
                <div class="card-header bg-info text-white">
                    <h5><i class="fas fa-robot"></i> –®–Ü –ê–Ω–∞–ª—ñ–∑ —Ç–∞ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü—ñ—ó</h5>
                </div>
                <div class="card-body">
                    <div class="ai-analysis">
                        <pre style="white-space: pre-wrap; background: #f8f9fa; padding: 20px; border-radius: 8px; border-left: 4px solid #17a2b8;">{{ result.ai_analysis }}</pre>
                    </div>
                </div>
            </div>
            {% endif %}

            <!-- –ö–æ—Ä–∏—Å–Ω—ñ –ø–æ—Å–∏–ª–∞–Ω–Ω—è -->
            <div class="row">
                {% if result.pages_with_positive %}
                <div class="col-md-6">
                    <div class="card">
                        <div class="card-header bg-success text-white">
                            <h5><i class="fas fa-link"></i> –°—Ç–æ—Ä—ñ–Ω–∫–∏ –∑ –ø–æ–∑–∏—Ç–∏–≤–Ω–∏–º–∏ —Å–ª–æ–≤–∞–º–∏ ({{ result.pages_with_positive|length }})</h5>
                        </div>
                        <div class="card-body" style="max-height: 400px; overflow-y: auto;">
                            <div class="list-group list-group-flush">
                                {% for url in result.pages_with_positive %}
                                <div class="list-group-item d-flex justify-content-between align-items-center px-0">
                                    <a href="{{ url }}" target="_blank" class="text-decoration-none text-truncate me-2">
                                        <i class="fas fa-external-link-alt"></i> {{ url|truncate(70) }}
                                    </a>
                                    <button class="btn btn-sm btn-outline-secondary" onclick="copyToClipboard('{{ url }}')">
                                        <i class="fas fa-copy"></i>
                                    </button>
                                </div>
                                {% endfor %}
                            </div>
                        </div>
                    </div>
                </div>
                {% endif %}
                
                {% if result.pages_with_negative %}
                <div class="col-md-6">
                    <div class="card">
                        <div class="card-header bg-danger text-white">
                            <h5><i class="fas fa-link"></i> –°—Ç–æ—Ä—ñ–Ω–∫–∏ –∑ –Ω–µ–≥–∞—Ç–∏–≤–Ω–∏–º–∏ —Å–ª–æ–≤–∞–º–∏ ({{ result.pages_with_negative|length }})</h5>
                        </div>
                        <div class="card-body" style="max-height: 400px; overflow-y: auto;">
                            <div class="list-group list-group-flush">
                                {% for url in result.pages_with_negative %}
                                <div class="list-group-item d-flex justify-content-between align-items-center px-0">
                                    <a href="{{ url }}" target="_blank" class="text-decoration-none text-truncate me-2">
                                        <i class="fas fa-external-link-alt"></i> {{ url|truncate(70) }}
                                    </a>
                                    <button class="btn btn-sm btn-outline-secondary" onclick="copyToClipboard('{{ url }}')">
                                        <i class="fas fa-copy"></i>
                                    </button>
                                </div>
                                {% endfor %}
                            </div>
                        </div>
                    </div>
                </div>
                {% endif %}
            </div>

            <!-- –ú–µ—Ç–∞–¥–∞–Ω—ñ -->
            <div class="card mt-4">
                <div class="card-header">
                    <h5><i class="fas fa-info-circle"></i> –¢–µ—Ö–Ω—ñ—á–Ω–∞ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è</h5>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-4">
                            <p><strong>Task ID:</strong> <code>{{ result.task_id }}</code></p>
                            <p><strong>–°—Ç–∞—Ç—É—Å:</strong> 
                                <span class="badge bg-{% if result.status == 'completed' %}success{% elif result.status == 'failed' %}danger{% else %}warning{% endif %}">
                                    {{ result.status|upper }}
                                </span>
                            </p>
                        </div>
                        <div class="col-md-4">
                            <p><strong>–î–∞—Ç–∞ —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è:</strong> {{ result.get('created_at', '–ù–µ–≤—ñ–¥–æ–º–æ') }}</p>
                            <p><strong>–î–∞—Ç–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—è:</strong> {{ result.completed_at }}</p>
                        </div>
                        <div class="col-md-4">
                            <p><strong>–ß–∞—Å –∞–Ω–∞–ª—ñ–∑—É:</strong> {{ result.analysis_time|round(2) }} —Å–µ–∫—É–Ω–¥</p>
                            <p><strong>–ï—Ñ–µ–∫—Ç–∏–≤–Ω—ñ—Å—Ç—å:</strong> {{ (result.pages_analyzed / result.analysis_time)|round(1) }} —Å—Ç–æ—Ä—ñ–Ω–æ–∫/—Å–µ–∫</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
// –§—É–Ω–∫—Ü—ñ—è –∫–æ–ø—ñ—é–≤–∞–Ω–Ω—è –≤ –±—É—Ñ–µ—Ä –æ–±–º—ñ–Ω—É
function copyToClipboard(text) {
    navigator.clipboard.writeText(text).then(() => {
        showNotification('–°–∫–æ–ø—ñ–π–æ–≤–∞–Ω–æ –≤ –±—É—Ñ–µ—Ä –æ–±–º—ñ–Ω—É', 'success');
    }).catch(() => {
        showNotification('–ü–æ–º–∏–ª–∫–∞ –∫–æ–ø—ñ—é–≤–∞–Ω–Ω—è', 'danger');
    });
}

// –§—É–Ω–∫—Ü—ñ—è –ø–æ–∫–∞–∑—É —É–≤–µ–¥–æ–º–ª–µ–Ω—å
function showNotification(message, type = 'info') {
    const notification = document.createElement('div');
    notification.className = `alert alert-${type} alert-dismissible fade show`;
    notification.style.position = 'fixed';
    notification.style.top = '20px';
    notification.style.right = '20px';
    notification.style.zIndex = '9999';
    notification.style.minWidth = '300px';
    
    notification.innerHTML = `
        <i class="fas fa-${type === 'success' ? 'check' : type === 'danger' ? 'exclamation-triangle' : 'info'}"></i>
        ${message}
        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
    `;
    
    document.body.appendChild(notification);
    
    setTimeout(() => {
        if (notification.parentNode) {
            notification.remove();
        }
    }, 5000);
}

// –°–æ—Ä—Ç—É–≤–∞–Ω–Ω—è —Ç–∞–±–ª–∏—Ü—å
document.addEventListener('DOMContentLoaded', function() {
    // –ü—Ä–æ—Å—Ç–∏–π –ø–æ—à—É–∫ –≤ —Ç–∞–±–ª–∏—Ü—è—Ö
    const searchInput = document.createElement('input');
    searchInput.type = 'text';
    searchInput.className = 'form-control mb-3';
    searchInput.placeholder = '–ü–æ—à—É–∫ –≤ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞—Ö...';
    
    // –î–æ–¥–∞—î–º–æ –ø–æ–ª–µ –ø–æ—à—É–∫—É –ø–µ—Ä–µ–¥ –ø–µ—Ä—à–æ—é —Ç–∞–±–ª–∏—Ü–µ—é
    const firstTable = document.querySelector('table');
    if (firstTable) {
        firstTable.parentNode.insertBefore(searchInput, firstTable);
        
        searchInput.addEventListener('input', function() {
            const searchTerm = this.value.toLowerCase();
            const rows = document.querySelectorAll('table tbody tr');
            
            rows.forEach(row => {
                const text = row.textContent.toLowerCase();
                if (text.includes(searchTerm)) {
                    row.style.display = '';
                } else {
                    row.style.display = 'none';
                }
            });
        });
    }
});

// –ï–∫—Å–ø–æ—Ä—Ç –≤ —Ä—ñ–∑–Ω–∏—Ö —Ñ–æ—Ä–º–∞—Ç–∞—Ö
function exportResults(format) {
    const taskId = '{{ result.task_id }}';
    
    if (format === 'excel') {
        window.location.href = `/result/${taskId}/download`;
    } else if (format === 'json') {
        fetch(`/api/analysis/result/${taskId}`)
            .then(response => response.json())
            .then(data => {
                const blob = new Blob([JSON.stringify(data, null, 2)], {type: 'application/json'});
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `analysis_${taskId}.json`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
            });
    }
}
</script>
{% endblock %}
